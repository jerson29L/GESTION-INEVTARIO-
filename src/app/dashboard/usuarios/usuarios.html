<div class="p-8 bg-gray-50 min-h-screen">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">Gestión de Usuarios</h1>
      <p class="text-gray-500">Administra los roles y el estado de los usuarios registrados en el sistema.</p>
    </div>
    <div>
      <button (click)="openNewUser()" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700">Nuevo Usuario</button>
    </div>
  </div>

  <!-- Mensajes -->
  <div *ngIf="showSuccess" class="mb-4 p-3 bg-green-100 text-green-800 rounded">Operación realizada con éxito</div>
  <div *ngIf="showError" class="mb-4 p-3 bg-red-100 text-red-800 rounded">{{ errorMessage }}</div>

  <!-- Contenedor de la tabla -->
  <div class="overflow-x-auto bg-white rounded-xl shadow-lg">
    <table class="min-w-full text-sm border-collapse">
      <thead class="bg-green-600 text-white">
        <tr>
          <th class="text-left px-6 py-3 font-semibold">Nombre</th>
          <th class="text-left px-6 py-3 font-semibold">Email</th>
          <th class="text-left px-6 py-3 font-semibold">Rol</th>
          <th class="text-left px-6 py-3 font-semibold">Estado</th>
          <th class="text-center px-6 py-3 font-semibold">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let usuario of usuarios" class="border-b hover:bg-gray-50 transition">
          <td class="px-6 py-3 font-medium text-gray-800">{{ usuario.nombre_completo }}</td>
          <td class="px-6 py-3 text-gray-700">{{ usuario.email }}</td>
          <td class="px-6 py-3">{{ usuario.rol_nombre }}</td>
          <td class="px-6 py-3">
          <span [ngClass]="{ 'text-green-600 font-semibold': usuario.estado === 1, 'text-red-600 font-semibold': usuario.estado === 0 }">
            {{ usuario.estado === 1 ? 'Activo' : 'Inactivo' }}
          </span>
          </td>
          <td class="px-6 py-3 text-center">
            <button (click)="openEditUser(usuario)" class="mx-1 px-3 py-1 bg-blue-50 text-blue-600 rounded border border-blue-200">Editar</button>
            <button (click)="askDelete(usuario)" class="mx-1 px-3 py-1 bg-red-50 text-red-600 rounded border border-red-200">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal: Formulario Nuevo/Editar -->
  <div *ngIf="showFormModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-2xl p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold">{{ editingUser.id ? 'Editar Usuario' : 'Nuevo Usuario' }}</h3>
        <button (click)="closeForm()" class="text-gray-500">Cerrar</button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-700 mb-1">Nombre completo</label>
          <input [(ngModel)]="editingUser.nombre_completo" class="input input-bordered w-full p-2 border rounded" />
        </div>

        <div>
          <label class="block text-sm text-gray-700 mb-1">Email</label>
          <input [(ngModel)]="editingUser.email" class="input input-bordered w-full p-2 border rounded" type="email" />
        </div>

        <div>
          <label class="block text-sm text-gray-700 mb-1">Rol</label>
          <select [(ngModel)]="editingUser.id_rol" class="select select-bordered w-full p-2 border rounded">
            <option *ngFor="let r of roles" [value]="r.id">{{ r.nombre }}</option>
          </select>
        </div>

        <div>
          <label class="block text-sm text-gray-700 mb-1">Estado</label>
          <select [(ngModel)]="editingUser.estado" class="select select-bordered w-full p-2 border rounded">
              <option [ngValue]="1">Activo</option>
              <option [ngValue]="0">Inactivo</option>
          </select>
        </div>

        <div>
          <label class="block text-sm text-gray-700 mb-1">Contraseña</label>
          <input [(ngModel)]="editingUser.password" class="input input-bordered w-full p-2 border rounded" type="password" placeholder="Dejar vacío para mantener la contraseña actual" />
          <p class="text-xs text-gray-500 mt-1">Si estás editando el usuario, deja este campo vacío para conservar la contraseña actual; escribe una nueva contraseña para actualizarla.</p>
        </div>
      </div>

      <div class="mt-6 text-right">
        <button (click)="closeForm()" class="mr-2 px-4 py-2 rounded border">Cancelar</button>
        <button (click)="saveUser()" class="px-4 py-2 bg-green-600 text-white rounded">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmar eliminación -->
  <div *ngIf="showDeleteModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-md p-6">
      <h3 class="text-lg font-semibold mb-4">Confirmar eliminación</h3>
      <p class="mb-6">¿Deseas marcar como Inactivo al usuario <strong>{{ userToDelete?.nombre_completo }}</strong>?</p>
      <div class="text-right">
        <button (click)="closeDelete()" class="mr-2 px-4 py-2 rounded border">Cancelar</button>
        <button (click)="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded">Confirmar</button>
      </div>
    </div>
  </div>
</div>
